name: Move to release
on:
  workflow_call:
jobs:
  trmPublish:
    name: TRM Set latest tag
    runs-on: ubuntu-latest
    steps:
      - uses: actions/download-artifact@master
        with:
          name: checkout
          path: ./
      - name: Unzip checkout
        run: unzip checkout.zip
      - name: Read manifest
        id: manifest
        uses: ./actions/regesta/booster/readManifest
        with:
          manifestPath: ./repo/manifest.json
      - name: Add latest tag
        uses: muhfaris/request-action@main
        with:
          url: https://trmregistry.com/registry/package/tag/${{ steps.manifest.outputs.packageName }}
          headers: "{\"Authorization\": \"Bearer ${{ secrets.TRM_TOKEN }}\"}"
          body: |
            {
              "tag": "latest",
              "version": "${{ steps.manifest.outputs.packageVersion }}\"
            }
          method: PUT
      - name: Remove rc tag
        uses: muhfaris/request-action@main
        with:
          url: https://trmregistry.com/registry/package/tag/${{ steps.manifest.outputs.packageName }}
          headers: "{\"Authorization\": \"Bearer ${{ secrets.TRM_TOKEN }}\"}"
          body: |
            {
              "tag": "rc"
            }
          method: DELETE
